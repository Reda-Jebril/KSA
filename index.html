المشكلة في الكود الخاص بك هي أن الروابط في قسم "المصادر" تستخدم href="#" كقيمة لخاصية href. هذا يجعل الرابط يشير إلى أعلى الصفحة الحالية بدلاً من فتح ملف PDF أو موقع ويب خارجي.

لإصلاح ذلك، يجب عليك استبدال "#" بالروابط (URLs) الفعلية لملفات PDF أو المواقع التي تريد أن تشير إليها هذه المصادر.

لقد قمت بتعديل الكود الخاص بك ليشمل أمثلة على كيفية القيام بذلك. لقد استبدلت href="#" بروابط أمثلة. يجب عليك استبدال هذه الروابط النموذجية بالروابط الفعلية لمصادرك.

التغييرات الرئيسية موجودة في قسم <section id="sources">. لقد حدثت أيضًا الملاحظة داخل هذا القسم لتوضيح أن الروابط هي أمثلة.

إليك الكود المعدل:

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تحليل تفاعلي لعمق شروخ الأسفلت في السعودية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A single-page application designed as an interactive dashboard. The structure is thematic rather than linear to facilitate user exploration. Key sections include: 1) An introduction with key stats. 2) An interactive card-based section for 'Crack Types'. 3) A visual grid for 'Influencing Factors'. 4) The core interactive element: a dynamic bar chart for 'Depth Estimation' that allows users to toggle between road types (Highway/Rural). 5) An accordion section for 'Recommendations'. 6) A new section for 'Sources' with placeholder links. This structure was chosen to transform a dense technical report into an intuitive, engaging tool for non-experts and professionals alike, focusing on discoverability and direct data interaction. -->
    <!-- Visualization & Content Choices: Report Info: Crack types and max depths -> Goal: Compare/Inform -> Viz: Interactive Horizontal Bar Chart -> Interaction: User can toggle a button to switch dataset between 'Highway' and 'Rural' road types, which dynamically updates the chart's data and scale -> Justification: This provides a clear, powerful comparison of crack severity under different common scenarios in KSA, making the key quantitative data easily digestible -> Library/Method: Chart.js (Canvas). Influencing factors are presented in a grid with icons for quick recognition. Recommendations are in an accordion. Sources are listed as clickable links (placeholders). Icons updated in navigation. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #FDFBF7;
            color: #3D352E;
        }
        .bg-primary { background-color: #FDFBF7; }
        .bg-secondary { background-color: #F4EFE6; }
        .bg-accent { background-color: #E68A00; }
        .text-accent { color: #E68A00; }
        .border-accent { border-color: #E68A00; }
        .active-nav {
            color: #E68A00;
            border-bottom: 2px solid #E68A00;
            padding-bottom: 4px;
        }
        .nav-link {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            padding-bottom: 4px;
            display: inline-flex;
            align-items: center;
        }
        .nav-link:hover {
            color: #E68A00;
        }
        .nav-link .icon {
            margin-left: 6px;
        }
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 500px;
            }
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="bg-primary">

    <nav id="navbar" class="bg-primary/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl font-bold text-accent">تحليل شروخ الأسفلت</h1>
            <div class="hidden md:flex items-center space-x-8 lg:space-x-10 text-lg">
                <a href="#hero" class="nav-link active-nav"><span class="icon">🏠</span>الرئيسية</a>
                <a href="#crack-types" class="nav-link"><span class="icon">🚧</span>أنواع الشروخ</a>
                <a href="#factors" class="nav-link"><span class="icon">⚙️</span>العوامل المؤثرة</a>
                <a href="#depth" class="nav-link"><span class="icon">📊</span>تقديرات العمق</a>
                <a href="#recommendations" class="nav-link"><span class="icon">💡</span>التوصيات</a>
                <a href="#sources" class="nav-link"><span class="icon">📚</span>المصادر</a>
            </div>
            <div class="md:hidden">
                <button id="mobile-menu-button" class="text-3xl text-gray-700">☰</button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-primary shadow-lg">
            <a href="#hero" class="block text-center py-3 px-4 text-lg hover:bg-secondary"><span class="icon">🏠</span> الرئيسية</a>
            <a href="#crack-types" class="block text-center py-3 px-4 text-lg hover:bg-secondary"><span class="icon">🚧</span> أنواع الشروخ</a>
            <a href="#factors" class="block text-center py-3 px-4 text-lg hover:bg-secondary"><span class="icon">⚙️</span> العوامل المؤثرة</a>
            <a href="#depth" class="block text-center py-3 px-4 text-lg hover:bg-secondary"><span class="icon">📊</span> تقديرات العمق</a>
            <a href="#recommendations" class="block text-center py-3 px-4 text-lg hover:bg-secondary"><span class="icon">💡</span> التوصيات</a>
            <a href="#sources" class="block text-center py-3 px-4 text-lg hover:bg-secondary"><span class="icon">📚</span> المصادر</a>
        </div>
    </nav>

    <main>
        <section id="hero" class="py-20 md:py-32">
            <div class="container mx-auto px-6 text-center">
                <h2 class="text-4xl md:text-6xl font-bold mb-4">أقصى عمق محتمل للشروخ</h2>
                <h3 class="text-2xl md:text-4xl font-semibold text-accent mb-8">في الرصفات الأسفلتية السعودية</h3>
                <p class="max-w-3xl mx-auto text-lg md:text-xl text-gray-700 leading-relaxed">
                    تواجه الطرق في المملكة العربية السعودية تحديات فريدة بسبب المناخ القاسي والأحمال المرورية العالية، مما يؤدي إلى ظهور شروخ يمكن أن تصل إلى أعماق كبيرة. هذا التطبيق التفاعلي يحلل البيانات من تقرير فني لتبسيط فهم هذه الظاهرة المعقدة.
                </p>
                <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto">
                    <div class="bg-secondary p-6 rounded-xl shadow-md">
                        <p class="text-4xl font-bold text-accent">72°م</p>
                        <p class="mt-2 text-lg">أقصى حرارة لسطح الرصفة</p>
                    </div>
                    <div class="bg-secondary p-6 rounded-xl shadow-md">
                        <p class="text-4xl font-bold text-accent">25+ سم</p>
                        <p class="mt-2 text-lg">عمق محتمل للشروخ في الطرق السريعة</p>
                    </div>
                    <div class="bg-secondary p-6 rounded-xl shadow-md">
                        <p class="text-4xl font-bold text-accent">5+</p>
                        <p class="mt-2 text-lg">عوامل رئيسية مؤثرة</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="crack-types" class="py-20 bg-secondary">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">أنواع الشروخ الرئيسية</h2>
                    <p class="mt-4 text-lg max-w-2xl mx-auto text-gray-700">لكل نوع من الشروخ مظهر وسبب وآلية انتشار مختلفة، مما يؤثر على العمق الذي يمكن أن يصل إليه. انقر على أي بطاقة لمعرفة المزيد.</p>
                </div>
                <div id="crack-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>
            </div>
        </section>

        <section id="factors" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">العوامل الأساسية المؤثرة</h2>
                    <p class="mt-4 text-lg max-w-2xl mx-auto text-gray-700">عمق الشروخ ليس نتيجة لعامل واحد، بل هو تفاعل معقد بين الظروف البيئية، الأحمال، خصائص المواد، وحالة التربة.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 text-center">
                    <div class="bg-secondary p-6 rounded-xl">
                        <div class="text-5xl mb-4">🚚</div>
                        <h3 class="text-xl font-bold mb-2">الأحمال المرورية</h3>
                        <p>الأحمال الثقيلة والمتكررة تسبب إجهادًا يؤدي إلى "شروخ الكلال" التي تبدأ من الأسفل وتنتشر لكامل العمق.</p>
                    </div>
                    <div class="bg-secondary p-6 rounded-xl">
                        <div class="text-5xl mb-4">☀️🌡️</div>
                        <h3 class="text-xl font-bold mb-2">العوامل البيئية</h3>
                        <p>تقلبات الحرارة العالية تسبب "شروخًا حرارية"، بينما تسرّع الحرارة القصوى من تقادم الأسفلت وهشاشته.</p>
                    </div>
                    <div class="bg-secondary p-6 rounded-xl">
                        <div class="text-5xl mb-4">🧱</div>
                        <h3 class="text-xl font-bold mb-2">خصائص المواد</h3>
                        <p>جودة المادة الرابطة، تصميم الخلطة، وسماكة طبقة الأسفلت تحدد مقاومة الرصفة للتشقق.</p>
                    </div>
                    <div class="bg-secondary p-6 rounded-xl">
                        <div class="text-5xl mb-4">🌱</div>
                        <h3 class="text-xl font-bold mb-2">التربة الأساسية</h3>
                        <p>ضعف التربة (مثل السبخة) يقلل الدعم ويسرّع من وصول الشروخ إلى أعماق كبيرة، ممتدة أحيانًا إلى طبقات الأساس.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="depth" class="py-20 bg-secondary">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">مقارنة تقديرات أقصى عمق للشروخ</h2>
                    <p class="mt-4 text-lg max-w-3xl mx-auto text-gray-700">
                        هذا المخطط يوضح أقصى عمق محتمل لمختلف أنواع الشروخ. يمكنك التبديل بين سيناريو "الطرق السريعة" (ذات طبقات أسفلتية أسمك) و"الطرق الزراعية" (ذات طبقات أرق) لملاحظة الفرق.
                    </p>
                </div>
                <div class="flex justify-center mb-8 space-x-4">
                    <button id="highway-btn" class="px-6 py-2 text-lg font-semibold rounded-md transition-all duration-300 bg-accent text-white shadow-lg">الطرق السريعة</button>
                    <button id="rural-btn" class="px-6 py-2 text-lg font-semibold rounded-md transition-all duration-300 bg-gray-300 text-gray-800">الطرق الزراعية</button>
                </div>
                <div class="chart-container">
                    <canvas id="depthChart"></canvas>
                </div>
                <div id="chart-context" class="mt-8 text-center bg-primary p-4 rounded-xl shadow-inner max-w-3xl mx-auto min-h-[50px]">
                    <p class="text-gray-600">مرر الفأرة فوق أحد الأعمدة في المخطط لعرض معلومات إضافية.</p>
                </div>
            </div>
        </section>

        <section id="recommendations" class="py-20">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">التوصيات الرئيسية للحد من الشروخ</h2>
                    <p class="mt-4 text-lg max-w-2xl mx-auto text-gray-700">يتطلب التحكم في عمق الشروخ نهجاً شاملاً يمتد من التصميم إلى الصيانة.</p>
                </div>
                <div id="accordion-container" class="max-w-4xl mx-auto space-y-4">
                </div>
            </div>
        </section>

        <section id="sources" class="py-20 bg-secondary">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold">المصادر والمراجع</h2>
                    <p class="mt-4 text-lg max-w-2xl mx-auto text-gray-700">قائمة بالمصادر العلمية والتقارير التي تم الاعتماد عليها في إعداد هذا التحليل. انقر على أي مصدر للاطلاع عليه (سيفتح في نافذة جديدة). <strong class="text-red-600">ملاحظة: تم استبدال الروابط النائبة "#" بأمثلة لروابط فعالة. يرجى استبدال هذه الأمثلة بالروابط الفعلية والدقيقة لمصادرك.</strong></p>
                </div>
                <div id="sources-list" class="max-w-3xl mx-auto space-y-4">
                    <a href="https://www.mot.gov.sa/sites/default/files/reports/technical_report_asphalt_cracks_sa_2023.pdf" target="_blank" rel="noopener noreferrer" class="block p-5 bg-primary rounded-xl shadow-md hover:shadow-lg transition-shadow text-accent hover:text-orange-700">
                        <h4 class="text-xl font-semibold mb-1">التقرير الفني المرجعي حول شروخ الأسفلت في السعودية</h4>
                        <p class="text-sm text-gray-600">الجهة الناشرة، سنة النشر (مثال: وزارة النقل السعودية، 2023)</p>
                    </a>
                    <a href="https://www.researchgate.net/publication/example_paper_on_temperature_effects_pavement.pdf" target="_blank" rel="noopener noreferrer" class="block p-5 bg-primary rounded-xl shadow-md hover:shadow-lg transition-shadow text-accent hover:text-orange-700">
                        <h4 class="text-xl font-semibold mb-1">دراسة حول تأثير درجات الحرارة القصوى على أداء الرصفات الأسفلتية</h4>
                        <p class="text-sm text-gray-600">اسم الباحث/الباحثين، اسم المجلة العلمية/المؤتمر، سنة النشر</p>
                    </a>
                     <a href="https://example.org/asphalt_design_guide_hot_climates.pdf" target="_blank" rel="noopener noreferrer" class="block p-5 bg-primary rounded-xl shadow-md hover:shadow-lg transition-shadow text-accent hover:text-orange-700">
                        <h4 class="text-xl font-semibold mb-1">دليل تصميم الرصفات الأسفلتية للمناطق الحارة</h4>
                        <p class="text-sm text-gray-600">معهد أبحاث الطرق أو جهة دولية معتمدة، سنة الإصدار</p>
                    </a>
                    <p class="text-center text-gray-600 mt-6">ملاحظة: هذه قائمة مبدئية. يرجى الرجوع إلى التقرير الأصلي للحصول على قائمة المراجع الكاملة والمفصلة.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-10">
        <div class="container mx-auto px-6 text-center">
            <p>تم إنشاء هذا التطبيق التفاعلي لتسهيل فهم تقرير "أقصى عمق محتمل للشروخ في الرصفات الأسفلتية المرنة بالمملكة العربية السعودية".</p>
            <p class="mt-2 text-sm text-gray-400">جميع البيانات مأخوذة من التقرير الفني المرجعي.</p>
            <p class="mt-4 text-sm text-gray-300">تصميم: آلاء يحيى</p>
        </div>
    </footer>

    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 z-50 modal-overlay opacity-0 pointer-events-none">
        <div id="modal-content" class="bg-primary rounded-xl shadow-2xl p-8 max-w-2xl w-full relative transform scale-95 transition-transform duration-300">
            <button id="modal-close-btn" class="absolute top-4 left-4 text-3xl font-bold text-gray-500 hover:text-gray-800">×</button>
            <div id="modal-body"></div>
        </div>
    </div>
    
    <script>
        const crackData = [
            { id: 'fatigue', icon: '🌐', name: 'شروخ الكلال (التمساحية)', description: 'سلسلة من الشروخ المترابطة تشبه جلد التمساح، ناتجة عن الأحمال المرورية المتكررة. تبدأ عادةً من أسفل الطبقة الإسفلتية وتنتشر للأعلى.', cause: 'فشل الكلال (التعب) تحت تأثير الأحمال المرورية العالية والمتكررة.' },
            { id: 'thermal', icon: '❄️', name: 'الشروخ الحرارية (المستعرضة)', description: 'شروخ تمتد بشكل عمودي على محور الطريق، ناتجة عن انكماش الأسفلت بسبب البرودة أو تصلب المادة الرابطة مع الزمن.', cause: 'التقلبات الحرارية الكبيرة وتقادم المادة الرابطة الإسفلتية.' },
            { id: 'longitudinal', icon: '↔️', name: 'الشروخ الطولية', description: 'شروخ تمتد بشكل موازٍ لمحور الطريق. أسبابها متعددة وقد تكون مرتبطة بالأحمال، فواصل الرصف، أو عوامل حرارية.', cause: 'سوء تنفيذ فواصل الرصف، انكماش حراري، أو قد تكون مرحلة مبكرة من شروخ الكلال.' },
            { id: 'block', icon: '🧱', name: 'شروخ الكتل', description: 'شبكة من الشروخ تقسم الرصفة إلى قطع مستطيلة كبيرة. تحدث بسبب انكماش الأسفلت نتيجة التقادم ودورات الحرارة اليومية.', cause: 'تقادم المادة الرابطة والتغيرات الحجمية اليومية بسبب الحرارة (غير مرتبطة بالحمولة).' },
            { id: 'reflection', icon: '🔄', name: 'الشروخ الانعكاسية', description: 'شروخ تظهر في طبقة التغطية الجديدة وتعكس نمط الشروخ أو الفواصل الموجودة في الطبقة القديمة تحتها.', cause: 'حركة (حرارية أو بسبب الأحمال) في الطبقة القديمة أسفل طبقة التغطية.' },
            { id: 'edge', icon: '📐', name: 'شروخ الحواف', description: 'شروخ طولية تظهر قرب حافة الرصفة، خاصة في الطرق التي لا تحتوي على أكتاف مرصوفة.', cause: 'ضعف الدعم الجانبي من الأكتاف، ضعف الدمك عند الحواف، وتسرب المياه.' }
        ];

        const depthData = {
            highway: {
                labels: ['شروخ الكلال', 'الشروخ الحرارية', 'الشروخ الطولية (حمولة)', 'شروخ من الأعلى للأسفل', 'شروخ الحواف', 'شروخ الكتل'],
                depths: [25, 25, 25, 15, 25, 8],
                contexts: [
                    'في الطرق السريعة، يمكن أن تصل شروخ الكلال إلى كامل عمق الطبقات الإسفلتية (25 سم أو أكثر) بسبب الأحمال الثقيلة.',
                    'التقلبات الحرارية الكبيرة والتقادم السريع للأسفلت في السعودية يمكن أن يؤدي إلى انتشار الشروخ الحرارية لكامل عمق الرصفة.',
                    'عندما تكون مرتبطة بالحمولة، تتصرف كشروخ الكلال ويمكن أن تصل إلى كامل العمق الإنشائي.',
                    'في الرصفات السميكة، قد تبدأ هذه الشروخ من السطح وتخترق لأعماق كبيرة (10-15 سم) وقد تصل لكامل العمق بمرور الوقت.',
                    'مع ضعف الدعم الجانبي، يمكن أن يتدهور كامل سمك الرصفة عند الحافة.',
                    'عادةً ما تكون سطحية، لكن مع التقادم الشديد يمكن أن تتعمق، وإن كان من غير المرجح أن تصل لكامل عمق طبقة سميكة.'
                ]
            },
            rural: {
                labels: ['شروخ الكلال', 'الشروخ الحرارية', 'الشروخ الطولية (حمولة)', 'شروخ من الأعلى للأسفل', 'شروخ الحواف', 'شروخ الكتل'],
                depths: [13, 13, 13, 10, 13, 6],
                contexts: [
                    'في الطرق الزراعية ذات الطبقات الأرق، تصل شروخ الكلال بسرعة إلى كامل العمق (13 سم) إذا كانت الأحمال موجودة.',
                    'تصل الشروخ الحرارية أيضًا إلى كامل العمق في الرصفات الرقيقة بسهولة أكبر.',
                    'في الرصفات الرقيقة، أي شرخ طولي مرتبط بالحمولة سيخترق كامل الطبقة.',
                    'هذه الآلية أقل شيوعًا في الرصفات الرقيقة، ولكن إذا حدثت، فإنها تتعمق بسرعة.',
                    'انهيار الحافة يؤثر على كامل عمق الرصفة الرقيقة.',
                    'تظل شروخ الكتل محصورة بشكل أكبر في الطبقة السطحية.'
                ]
            }
        };

        const recommendationsData = [
            { title: 'توصيات التصميم', content: 'استخدام مواد رابطة معدلة بالبوليمر لمقاومة الحرارة والتقادم. تصميم خلطات إسفلتية متوازنة تقاوم التخدد والتشقق. تحسين خصائص التربة الأساسية (خاصة السبخة) وتوفير نظام صرف فعال. معالجة الشروخ القديمة قبل وضع أي طبقات تغطية جديدة لمنع الانعكاس.' },
            { title: 'توصيات التنفيذ', content: 'الالتزام الصارم بالمواصفات الفنية. تحقيق الدمك الكافي والمطلوب لجميع الطبقات، مع التركيز على الحواف والفواصل الطولية. المراقبة الدقيقة لدرجات حرارة الخلطة الإسفلتية أثناء الفرش والدمك لضمان المتانة.' },
            { title: 'توصيات الصيانة', content: 'تطبيق برامج صيانة وقائية واستباقية، مثل الختم المبكر للشروخ لمنع تسرب المياه وتفاقمها. استخدام تقنيات متقدمة لتقييم حالة الرصف وتحديد أولويات الصيانة. التحقيق في الأسباب الجذرية للشروخ العميقة (عبر العينات اللبية) قبل الإصلاح.' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const crackCardsContainer = document.getElementById('crack-cards-container');
            crackData.forEach(crack => {
                const card = document.createElement('div');
                card.className = 'card bg-primary p-6 rounded-xl shadow-md cursor-pointer text-center';
                card.innerHTML = `
                    <div class="text-5xl mb-4">${crack.icon}</div>
                    <h3 class="text-xl font-bold">${crack.name}</h3>
                `;
                card.addEventListener('click', () => openModal(crack));
                crackCardsContainer.appendChild(card);
            });

            const accordionContainer = document.getElementById('accordion-container');
            recommendationsData.forEach((rec, index) => {
                const item = document.createElement('div');
                item.className = 'border border-gray-200 rounded-lg overflow-hidden';
                item.innerHTML = `
                    <button class="accordion-header w-full text-right p-4 bg-secondary hover:bg-gray-200 flex justify-between items-center transition">
                        <span class="font-semibold text-lg">${rec.title}</span>
                        <span class="accordion-icon text-2xl font-light transform transition-transform">+</span>
                    </button>
                    <div class="accordion-content bg-primary">
                        <p class="p-4 text-gray-700 leading-relaxed">${rec.content}</p>
                    </div>
                `;
                accordionContainer.appendChild(item);
            });

            const accordionHeaders = document.querySelectorAll('.accordion-header');
            accordionHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const content = header.nextElementSibling;
                    const icon = header.querySelector('.accordion-icon');
                    
                    document.querySelectorAll('.accordion-content').forEach(c => {
                        if (c !== content) {
                            c.style.maxHeight = null;
                            if (c.previousElementSibling) {
                                const prevIcon = c.previousElementSibling.querySelector('.accordion-icon');
                                if (prevIcon) {
                                    prevIcon.textContent = '+';
                                    prevIcon.classList.remove('rotate-45');
                                }
                            }
                        }
                    });

                    if (content.style.maxHeight) {
                        content.style.maxHeight = null;
                        icon.textContent = '+';
                        icon.classList.remove('rotate-45');
                    } else {
                        content.style.maxHeight = content.scrollHeight + "px";
                        icon.textContent = '+';
                        icon.classList.add('rotate-45');
                    }
                });
            });

            const modalContainer = document.getElementById('modal-container');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalContent = document.getElementById('modal-content');
            
            function openModal(crack) {
                const modalBody = document.getElementById('modal-body');
                modalBody.innerHTML = `
                    <h2 class="text-3xl font-bold mb-4 text-accent">${crack.name}</h2>
                    <p class="text-lg mb-4 text-gray-800">${crack.description}</p>
                    <hr class="my-4">
                    <h3 class="text-xl font-semibold mb-2">السبب الرئيسي:</h3>
                    <p class="text-lg text-gray-700">${crack.cause}</p>
                `;
                modalContainer.classList.remove('opacity-0', 'pointer-events-none');
                modalContent.classList.remove('scale-95');
            }

            function closeModal() {
                modalContainer.classList.add('opacity-0');
                modalContent.classList.add('scale-95');
                setTimeout(() => {
                    modalContainer.classList.add('pointer-events-none');
                }, 300);
            }

            modalCloseBtn.addEventListener('click', closeModal);
            modalContainer.addEventListener('click', (e) => {
                if (e.target === modalContainer) {
                    closeModal();
                }
            });

            const ctx = document.getElementById('depthChart').getContext('2d');
            let depthChart;
            const chartContext = document.getElementById('chart-context');

            function createOrUpdateChart(roadType) {
                const data = depthData[roadType];
                const chartTitle = roadType === 'highway' ? 'أقصى عمق محتمل (سم) - الطرق السريعة' : 'أقصى عمق محتمل (سم) - الطرق الزراعية';
                const maxDepth = roadType === 'highway' ? 30 : 15;

                if (depthChart) {
                    depthChart.data.labels = data.labels;
                    depthChart.data.datasets[0].data = data.depths;
                    depthChart.options.scales.x.max = maxDepth;
                    depthChart.options.plugins.title.text = chartTitle;
                    depthChart.update();
                } else {
                    depthChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.labels,
                            datasets: [{
                                label: 'أقصى عمق (سم)',
                                data: data.depths,
                                backgroundColor: 'rgba(230, 138, 0, 0.6)',
                                borderColor: 'rgba(230, 138, 0, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            indexAxis: 'y',
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    max: maxDepth,
                                    title: {
                                        display: true,
                                        text: 'العمق (سم)',
                                        font: { size: 14, family: 'Tajawal' }
                                    },
                                    ticks: {
                                        font: { family: 'Tajawal' }
                                    }
                                },
                                y: {
                                    ticks: {
                                        font: { size: 12, family: 'Tajawal' }
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                title: {
                                    display: true,
                                    text: chartTitle,
                                    font: { size: 18, family: 'Tajawal' },
                                    padding: { top: 10, bottom: 20 }
                                },
                                tooltip: {
                                    enabled: true,
                                    bodyFont: { family: 'Tajawal' },
                                    titleFont: { family: 'Tajawal' },
                                    callbacks: {
                                        label: function(context) {
                                            let label = context.dataset.label || '';
                                            if (label) {
                                                label += ': ';
                                            }
                                            if (context.parsed.x !== null) {
                                                label += context.parsed.x + ' سم';
                                            }
                                            return label;
                                        }
                                    }
                                }
                            },
                            onHover: (event, chartElement) => {
                                if (chartElement.length > 0) {
                                    const index = chartElement[0].index;
                                    chartContext.innerHTML = `<p class="text-gray-800 font-semibold">${data.labels[index]}:</p><p class="text-gray-700">${data.contexts[index]}</p>`;
                                } else {
                                     chartContext.innerHTML = `<p class="text-gray-600">مرر الفأرة فوق أحد الأعمدة في المخطط لعرض معلومات إضافية.</p>`;
                                }
                            }
                        }
                    });
                }
            }

            const highwayBtn = document.getElementById('highway-btn');
            const ruralBtn = document.getElementById('rural-btn');

            highwayBtn.addEventListener('click', () => {
                createOrUpdateChart('highway');
                highwayBtn.classList.add('bg-accent', 'text-white', 'shadow-lg');
                highwayBtn.classList.remove('bg-gray-300', 'text-gray-800');
                ruralBtn.classList.add('bg-gray-300', 'text-gray-800');
                ruralBtn.classList.remove('bg-accent', 'text-white', 'shadow-lg');
            });

            ruralBtn.addEventListener('click', () => {
                createOrUpdateChart('rural');
                ruralBtn.classList.add('bg-accent', 'text-white', 'shadow-lg');
                ruralBtn.classList.remove('bg-gray-300', 'text-gray-800');
                highwayBtn.classList.add('bg-gray-300', 'text-gray-800');
                highwayBtn.classList.remove('bg-accent', 'text-white', 'shadow-lg');
            });
            
            createOrUpdateChart('highway');

            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            const navLinks = document.querySelectorAll('#navbar a[href^="#"]');
            const sections = document.querySelectorAll('main section');
            
            function updateActiveNav() {
                let current = 'hero'; 
                const navHeight = document.getElementById('navbar').offsetHeight;
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - navHeight - 20) { 
                        current = section.getAttribute('id');
                    }
                });
                
                navLinks.forEach(link => {
                    link.classList.remove('active-nav');
                    if (link.getAttribute('href').substring(1) === current) {
                        link.classList.add('active-nav');
                    }
                });

                const mobileNavLinks = document.querySelectorAll('#mobile-menu a[href^="#"]');
                 mobileNavLinks.forEach(link => {
                    link.classList.remove('bg-accent', 'text-white', 'font-semibold');
                     link.classList.add('hover:bg-secondary');
                    if (link.getAttribute('href').substring(1) === current) {
                        link.classList.add('bg-accent', 'text-white', 'font-semibold');
                        link.classList.remove('hover:bg-secondary');
                    }
                })
            }

            window.addEventListener('scroll', updateActiveNav);
            updateActiveNav(); 
            
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    if (targetId && targetId.length > 1 && targetId.startsWith('#')) { // Check if targetId is a valid hash
                        const targetElement = document.querySelector(targetId);
                        if (targetElement) {
                             const navHeight = document.getElementById('navbar').offsetHeight;
                             const offsetTop = targetElement.offsetTop - navHeight;
                             window.scrollTo({
                                top: offsetTop,
                                behavior: 'smooth'
                            });
                        }
                    }
                    if (mobileMenu.classList.contains('hidden') === false) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

        });
    </script>

</body>
</html>
